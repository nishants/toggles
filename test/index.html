<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body ng-app="feature-toggle">

<div>
    <label>Environment : </label>
    <input ng-bind="toggles.env">
</div>
<div>
    <label>Features : </label>
    <div ng-bind="toggles.features | jsonfied"></div>
</div>

<div feature="espp">
    You cant see me.
</div>


<script src="../support/angular1.5.8.min.js"></script>
<script>
    var app = angular.module("feature-toggle", []);
    app.run(['$rootScope', '$http', 'toggles', function ($rootScope, $http, toggles) {
        return $http.get("config/features.json").then(function(response){
            var env         = "default",
                features    = response.data[env]["features"],
                disabled    = {};

            for(var featureName in features){
                if(!features[featureName]){
                    disabled[featureName] = true;
                }
            }
            var config = {
                env: env,
                disabled: disabled
            };
            toggles.set(config);
            $rootScope.toggles = config;
            return response;
        });
    }]);

    app.filter("jsonfied", [function(){
        return function(json){
            return JSON.stringify(json);
        };
    }]);

    app.service("toggles", function(){
        var config = {};
        return {
            set : function(param){
                config = param;
            },
            get : function(){
                return config;
            }
        }
    });
    app.directive('feature', function (toggles) {
        return {
            restrict : "A",
            link: function (scope, element, attrs) {
                var tog = toggles.get();
                var disabled = tog.disabled[attrs.feature];
                disabled ?  element.remove() : "";
            }
        };
    });
</script>
</body>
</html>